{% extends 'ironcage/base.html' %}

{% load static %}

{% block content %}
<h1>Details of your order</h1>

{% include './_invoice_details.html' %}

{% if invoice.payment_status == 'FLD' or invoice.payment_status is None %}
<div id="stripe-form">
  <form action="{% url 'payments:invoice_payment' invoice_id=invoice.id %}" method="POST">
    {% csrf_token %}
    <script
      src="https://checkout.stripe.com/checkout.js" class="stripe-button"
      data-key="{{ stripe_api_key }}"
      data-amount="{{ invoice.total_pence_inc_vat }}"
      data-currency="gbp"
      data-name="PyCon UK Society Ltd"
      data-image="{% static 'ironcage/img/yellow.png' %}"
      data-description="PyCon UK 2018 invoice {{ invoice.item_id }}"
      data-locale="auto"
      data-email="{{ invoice.purchaser.email_addr }}"
    >
    </script>

    <!-- https://stackoverflow.com/a/41527060 -->
    <style>.stripe-button-el { display: none; }</style>
    <button class="btn btn-primary" type="submit">Pay by card</button>
  </form>

</div>
{% elif not invoice.payment_required %}
<div class="row">
  <div class="col-md-6">
    {% if invoice.payments.count == 1 %}
      <a href="{% url 'payments:payment' invoice.payments.first.id %}" class="btn btn-primary">View receipt</a>
    {% else %}
      {% for payment in invoice.payments.all %}
        <a href="{% url 'payments:payment' payment.id %}" class="">Receipt #{{ payment.id }} ({{payment.get_status_display}})</a><br>
      {% endfor %}
    {% endif %}
    {% if ticket %}
    <a href="{% url 'tickets:ticket' ticket.ticket_id %}" class="btn btn-primary">View your ticket</a>
    {% endif %}
  </div>
</div>
{% endif %}

{% endblock %}
